<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projects (React) — Jared Consulting</title>
  <meta name="description" content="React SPA for managing consulting projects in localStorage." />
  <meta name="theme-color" content="#2563eb" />
  <meta property="og:title" content="Projects (React) — Jared Consulting" />
  <meta property="og:description" content="Dashboard, list, details, and forms powered by React and localStorage." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/og-image.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Projects (React) — Jared Consulting" />
  <meta name="twitter:description" content="Dashboard, list, details, and forms powered by React and localStorage." />
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="dns-prefetch" href="//unpkg.com">
  <link rel="stylesheet" href="projects.css" />
</head>
<body>
  <a href="#main" class="skip-link">Skip to content</a>
  <header class="site-header">
    <nav class="container nav" aria-label="Primary navigation">
      <a href="#/" class="logo">Jared<span>Consulting</span></a>
      <ul class="nav-links">
        <li><a href="#/">Dashboard</a></li>
        <li><a href="#/projects">Projects</a></li>
        <li><a href="#/new" class="btn btn-primary small">+ New Project</a></li>
        <li><a href="index.html" class="btn btn-ghost small">Main Site</a></li>
      </ul>
    </nav>
  </header>

  <main id="main" class="container" tabindex="-1">
    <div id="root" class="app" role="region" aria-label="Projects application"></div>
  </main>

  <footer class="site-footer">
    <div class="container footer-grid">
      <p>© <span id="year"></span> Jared Consulting.</p>
      <a class="to-top" href="#/" aria-label="Back to top">↑</a>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = String(new Date().getFullYear());
  </script>

  <!-- React and Router (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-router-dom@6/umd/react-router-dom.development.js"></script>
  <!-- Babel for in-browser JSX transform (dev only) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;
    const { createRoot } = ReactDOM;
    const { HashRouter, Routes, Route, Link, useNavigate, useParams } = ReactRouterDOM;

    // Storage utilities (preserve existing data)
    const LS_KEY = 'jc_projects_v1';
    const load = () => { try { return JSON.parse(localStorage.getItem(LS_KEY) || '[]'); } catch { return []; } };
    const save = (items) => localStorage.setItem(LS_KEY, JSON.stringify(items));
    const uid = () => Math.random().toString(36).slice(2,10);

    const useProjects = () => {
      const [items, setItems] = useState(() => load().sort((a,b)=>(b.updatedAt||0)-(a.updatedAt||0)));
      const refresh = () => setItems(load().sort((a,b)=>(b.updatedAt||0)-(a.updatedAt||0)));
      const upsert = (proj) => {
        const list = load();
        const idx = list.findIndex(p=>p.id===proj.id);
        proj.updatedAt = Date.now();
        if (idx>=0) list[idx]=proj; else list.push(proj);
        save(list); refresh();
      };
      const remove = (id) => { save(load().filter(p=>p.id!==id)); refresh(); };
      const get = (id) => load().find(p=>p.id===id) || null;
      return { items, upsert, remove, get, refresh };
    };

    const fmtUSD = (n) => new Intl.NumberFormat(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0}).format(Number(n)||0);
    const Badge = ({status}) => <span className={`badge ${status}`}>{(status||'').slice(0,1).toUpperCase()+(status||'').slice(1)}</span>;

    function Layout({children}){
      return <div className="app">{children}</div>;
    }

    function Dashboard(){
      const { items } = useProjects();
      const total = items.length;
      const active = items.filter(p=>p.status==='active').length;
      const paused = items.filter(p=>p.status==='paused').length;
      const closed = items.filter(p=>p.status==='closed').length;
      const budget = items.reduce((s,p)=> s + (Number(p.budget)||0), 0);
      const upcoming = useMemo(()=> items.filter(p=>p.endDate).sort((a,b)=> new Date(a.endDate)-new Date(b.endDate)).slice(0,5), [items]);

      return (
        <Layout>
          <div className="cards">
            <Metric title="Total Projects" value={String(total)} />
            <Metric title="Active" value={String(active)} />
            <Metric title="Paused" value={String(paused)} />
            <Metric title="Closed" value={String(closed)} />
            <Metric title="Budget (sum)" value={fmtUSD(budget)} />
          </div>
          <section className="section">
            <h2>Upcoming Deadlines</h2>
            {upcoming.length===0 ? (
              <p className="helper">No upcoming deadlines.</p>
            ) : (
              <table className="table">
                <thead><tr><th>Project</th><th>Client</th><th>Due</th><th>Status</th></tr></thead>
                <tbody>
                  {upcoming.map(p=> (
                    <tr key={p.id}>
                      <td><Link to={`#/project/${p.id}`.replace('#','')}>{p.name}</Link></td>
                      <td>{p.client||'—'}</td>
                      <td>{p.endDate||'—'}</td>
                      <td><Badge status={p.status} /></td>
                    </tr>
                  ))}
                </tbody>
              </table>
            )}
          </section>
        </Layout>
      );
    }

    const Metric = ({title, value}) => (
      <div className="card">
        <div className="helper">{title}</div>
        <div className="metric">{value}</div>
      </div>
    );

    function ProjectList(){
      const { items, remove } = useProjects();
      return (
        <Layout>
          <section className="section">
            <h2>Projects</h2>
            <div className="actions"><Link className="btn btn-primary" to="#/new" replace>+ New Project</Link></div>
            <table className="table">
              <thead><tr><th>Name</th><th>Client</th><th>Status</th><th>Budget</th><th>Dates</th><th></th></tr></thead>
              <tbody>
                {items.length===0 ? (
                  <tr><td className="helper" colSpan="6">No projects yet.</td></tr>
                ) : items.map(p=> (
                  <tr key={p.id}>
                    <td><Link to={`#/project/${p.id}`.replace('#','')}>{p.name}</Link></td>
                    <td>{p.client||'—'}</td>
                    <td><Badge status={p.status} /></td>
                    <td>{p.budget? fmtUSD(p.budget) : '—'}</td>
                    <td>{[p.startDate||'', p.endDate||''].filter(Boolean).join(' → ') || '—'}</td>
                    <td>
                      <Link className="btn btn-ghost small" to={`#/edit/${p.id}`.replace('#','')}>Edit</Link>
                      <button className="btn small" onClick={()=>{ if (confirm(`Delete "${p.name}"?`)) remove(p.id); }}>Delete</button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </section>
        </Layout>
      );
    }

    function ProjectDetail(){
      const { get } = useProjects();
      const params = useParams();
      const id = params.id;
      const p = get(id);
      if (!p) return <Layout><section className="section"><h2>Not found</h2><p className="helper">Project does not exist.</p></section></Layout>;
      return (
        <Layout>
          <section className="section">
            <h2>{p.name}</h2>
            <p><strong>Client:</strong> {p.client||'—'}</p>
            <p><strong>Status:</strong> <Badge status={p.status} /></p>
            <p><strong>Budget:</strong> {p.budget? fmtUSD(p.budget):'—'}</p>
            <p><strong>Dates:</strong> {(p.startDate||'—')} → {(p.endDate||'—')}</p>
            <h3>Description</h3>
            <p className="helper">{p.description||'—'}</p>
            <div className="actions">
              <Link className="btn btn-primary" to={`#/edit/${p.id}`.replace('#','')}>Edit Project</Link>
              <Link className="btn btn-ghost" to="#/projects" replace>Back to List</Link>
            </div>
          </section>
        </Layout>
      );
    }

    function ProjectForm(){
      const { get, upsert } = useProjects();
      const params = useParams();
      const navigate = useNavigate();
      const isEdit = Boolean(params.id);
      const existing = isEdit ? get(params.id) : null;
      const [state, setState] = useState(existing || { id: uid(), name:'', client:'', status:'prospect', budget:'', startDate:'', endDate:'', description:'' });
      const [err, setErr] = useState('');

      useEffect(()=>{ if (existing) setState(existing); }, [params.id]);

      const onSubmit = (e) => {
        e.preventDefault();
        setErr('');
        if (!state.name || state.name.trim().length < 3){ setErr('Name must be at least 3 characters.'); return; }
        const item = {
          ...state,
          name: String(state.name).trim(),
          client: String(state.client||'').trim(),
          status: String(state.status||'prospect'),
          budget: state.budget!==''? Number(state.budget):'',
          startDate: state.startDate||'',
          endDate: state.endDate||'',
          description: String(state.description||'').trim(),
          createdAt: existing?.createdAt || Date.now(),
        };
        upsert(item);
        navigate(`#/project/${item.id}`.replace('#',''), { replace: true });
      };

      const set = (k) => (e) => setState(s=> ({...s, [k]: e.target.value }));

      return (
        <Layout>
          <section className="section">
            <h2>{isEdit? 'Edit Project':'New Project'}</h2>
            <form className="form" onSubmit={onSubmit}>
              <div className="row">
                <div className="field">
                  <label htmlFor="name">Project name</label>
                  <input id="name" value={state.name} onChange={set('name')} placeholder="e.g., AI Roadmap" required />
                  <small className="error">{err}</small>
                </div>
                <div className="field">
                  <label htmlFor="client">Client</label>
                  <input id="client" value={state.client} onChange={set('client')} placeholder="e.g., Acme Corp" />
                </div>
              </div>
              <div className="row">
                <div className="field">
                  <label htmlFor="status">Status</label>
                  <select id="status" value={state.status} onChange={set('status')}>
                    {['prospect','active','paused','closed'].map(s=> <option key={s} value={s}>{s.slice(0,1).toUpperCase()+s.slice(1)}</option>)}
                  </select>
                </div>
                <div className="field">
                  <label htmlFor="budget">Budget (USD)</label>
                  <input id="budget" type="number" min="0" step="1000" value={state.budget} onChange={set('budget')} placeholder="50000" />
                </div>
              </div>
              <div className="row">
                <div className="field">
                  <label htmlFor="startDate">Start date</label>
                  <input id="startDate" type="date" value={state.startDate} onChange={set('startDate')} />
                </div>
                <div className="field">
                  <label htmlFor="endDate">End date</label>
                  <input id="endDate" type="date" value={state.endDate} onChange={set('endDate')} />
                </div>
              </div>
              <div className="field">
                <label htmlFor="description">Description</label>
                <textarea id="description" rows="6" value={state.description} onChange={set('description')} placeholder="Project goals, scope, and deliverables"></textarea>
              </div>
              <div className="actions">
                <button type="submit" className="btn btn-primary">{isEdit? 'Save Changes':'Create Project'}</button>
                <Link className="btn btn-ghost" to="#/projects" replace>Cancel</Link>
              </div>
            </form>
          </section>
        </Layout>
      );
    }

    function App(){
      return (
        <HashRouter>
          <Routes>
            <Route path="/" element={<Dashboard/>} />
            <Route path="/projects" element={<ProjectList/>} />
            <Route path="/project/:id" element={<ProjectDetail/>} />
            <Route path="/new" element={<ProjectForm/>} />
            <Route path="/edit/:id" element={<ProjectForm/>} />
            <Route path="*" element={<Dashboard/>} />
          </Routes>
        </HashRouter>
      );
    }

    createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
